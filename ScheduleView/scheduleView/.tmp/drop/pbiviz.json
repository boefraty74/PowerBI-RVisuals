{"visual":{"name":"PowerBI-rvisuals-scheduleview","displayName":"ScheduleView","guid":"PBI_CV_658497A5_7E34_4F94_A51F_4E2213BB9051","visualClassName":"Visual","version":"1.0.0","description":"<span>With schedule view you can visualize the start and stop of events. Think of resource planning and systemstates shown in one graphic. <br/><br/><span style='font-style:italic'>Service prerequisites:</span> R-powered custom visual is used in service seamlessly<br/><br /><span style='font-style:italic'>Desktop prerequisites:</span> To run R scripts in Power BI Desktop, you must separately install R on your local computer.<br />You can download and install R for free from the <a href='https://mran.revolutionanalytics.com/download/'>Revolution Open download page</a> or the <a href='https://cran.r-project.org/bin/windows/base/'>CRAN Repository</a><br /><br /> <span style='font-style:italic'> R package dependencies(auto-installed): </span> ggplot2, grid, gridExtra, wesandrson <br /><br /> <span style='font-style:italic'> Supports R versions: </span> R 3.3.1, R 3.3.0, MRO 3.3.1, MRO 3.3.0 <br /></span>","supportUrl":"http://community.powerbi.com/","gitHubUrl":"https://github.com/fathomson/PowerBI-RVisuals/tree/master/ScheduleView/scheduleView"},"apiVersion":"1.3.0","author":{"name":"ICT GROUP","email":"frank.thomson@ict.nl"},"assets":{"icon":"assets/icon.png"},"externalJS":[],"style":"style/visual.less","capabilities":{"dataRoles":[{"displayName":"Resource","kind":"Grouping","name":"Resource"},{"displayName":"User","kind":"Grouping","name":"User"},{"displayName":"Start","kind":"Grouping","name":"Start"},{"displayName":"End","kind":"Grouping","name":"End"}],"dataViewMappings":[{"conditions":[{"Resource":{"max":1},"User":{"max":1},"Start":{"max":1},"End":{"max":1}}],"scriptResult":{"dataInput":{"table":{"rows":{"select":[{"for":{"in":"Resource"}},{"for":{"in":"User"}},{"for":{"in":"Start"}},{"for":{"in":"End"}}],"dataReductionAlgorithm":{"top":{}}}}},"script":{"scriptProviderDefault":"R","scriptOutputType":"png","source":{"objectName":"rcv_script","propertyName":"source"},"provider":{"objectName":"rcv_script","propertyName":"provider"},"scriptSourceDefault":"# Copyright (c) ICT GROUP.  All rights reserved.\r\n\r\n##PBI_R_VISUAL: VIZGAL_SCVIEW  Graphical display of schedule, planning or other events.\r\n# Visualise schedule, planning or events in one graph\r\n#\r\n# INPUT:\r\n# Name, Type, Start, End\r\n#\r\n# CREATION DATE: 12/08/2016\r\n#\r\n# LAST UPDATE: 12/08/2016\r\n#\r\n# VERSION: 0.0.1\r\n#\r\n# R VERSION TESTED: 3.3.2\r\n#\r\n# AUTHOR: F.A. THOMSON (frank.thomson@ict.nl)\r\n\r\n\r\n############### LIBRARY DECLARATIONS ###############\r\n\r\nlibraryRequireInstall = function(packageName, ...)\r\n{\r\n  if (!require(packageName, character.only = TRUE))\r\n    warning(paste(\"*** The package: '\", packageName, \"' was not installed ***\", sep =\r\n                    \"\"))\r\n}\r\n\r\nlibraryRequireInstall(\"ggplot2\")\r\nlibraryRequireInstall(\"grid\")\r\nlibraryRequireInstall(\"gridExtra\")\r\nlibraryRequireInstall(\"wesanderson\")\r\n\r\n############ INTERNAL FUNCTIONS #########\r\n\r\n# plot error message to user\r\nshowErrorMessageToUser <- function(message) {\r\n  par(mar = c(0, 0, 0, 0))\r\n  plot(\r\n    c(0, 1),\r\n    c(0, 1),\r\n    ann = F,\r\n    bty = 'n',\r\n    type = 'n',\r\n    xaxt = 'n',\r\n    yaxt = 'n'\r\n  )\r\n  text(\r\n    x = 0.5,\r\n    y = 0.5,\r\n    message,\r\n    cex = 1.6,\r\n    col = \"black\"\r\n  )\r\n}\r\n\r\n# check if date in handable format\r\n# TDOD for next version: support multiple date formats\r\ndateInCorrectFormat <- function(date) {\r\n  d <- try(as.Date(date, format = \"%Y-%m-%dT%H:%M:%OS\"))\r\n  return (class(d) != \"try-error\" & !is.na(d))\r\n}\r\n\r\n\r\n\r\n############ INPUT / DATE VALIDATION #########\r\n\r\ninput_valid <- TRUE\r\ndates_valid <- TRUE\r\nmessage <- \"\"\r\n\r\nif (!exists(\"Resource\")) {\r\n  input_valid <- FALSE\r\n  message <- paste(message, \"Resource \")\r\n}\r\nif (!exists(\"User\")) {\r\n  input_valid <- FALSE\r\n  message <- paste(message, \"User \")\r\n}\r\nif (!exists(\"Start\")) {\r\n  input_valid <- FALSE\r\n  message <- paste(message, \"Start \")\r\n}\r\nif (!exists(\"End\")) {\r\n  input_valid <- FALSE\r\n  message <- paste(message, \"End \" + settings_orientation)\r\n}\r\n\r\n\r\n\r\n\r\n\r\nif (input_valid) {\r\n  # Assign columns to dataset\r\n  dataset <- cbind(Resource, User, Start, End)\r\n  # Rename columns\r\n  colnames(dataset) <- c(\"Resource\", \"User\", \"Start\", \"End\")\r\n  # Remvoe NA's\r\n  dataset <- na.omit(dataset)\r\n  dates_valid <-   (dateInCorrectFormat(dataset$Start[1]) &\r\n                      dateInCorrectFormat(dataset$End[1]))\r\n} else {\r\n  dates_valid <- FALSE\r\n  plot.new()\r\n  #showErrorMessageToUser(paste(\"All four fields required, please add: \", message))\r\n}\r\n\r\n\r\n\r\n############ INPUT / DATE VALIDATION #########\r\nif(input_valid){\r\n\r\nif (dates_valid) {\r\n  \r\n  if (!exists(\"settings_colorPalette\"))\r\n  {\r\n    settings_colorPalette = \"Set1\";\r\n  }\r\n  \r\n  if (!exists(\"settings_orientation\"))\r\n  {\r\n    settings_orientation= \"horizontal\";\r\n  }\r\n  \r\n  dataset$Start <-\r\n    as.POSIXct(dataset$Start, format = \"%Y-%m-%dT%H:%M:%OS\")\r\n  dataset$End <-\r\n    as.POSIXct(dataset$End,  format = \"%Y-%m-%dT%H:%M:%OS\")\r\n  \r\n  if(settings_orientation == \"horizontal\"){\r\n  ggplot(dataset, aes(x = Start, y = Resource, color = User)) +\r\n    geom_segment(aes(x = Start, xend = End, y = Resource,yend = Resource), size = 15) +\r\n    scale_colour_discrete(guide = guide_legend(override.aes = list(size = 10))) +\r\n    xlab(\"Time\") +\r\n    ylab(names(Resource)) +\r\n    labs(color=names(User))+\r\n    theme_bw() + \r\n    scale_colour_brewer(palette = settings_colorPalette)\r\n  } else {\r\n    ggplot(dataset, aes(x = Resource, y = Start, color = User)) +\r\n      geom_segment(aes(x = Resource, xend = Resource, y = Start,yend = End), size = 15) +\r\n      scale_colour_discrete(guide = guide_legend(override.aes = list(size = 10))) +\r\n      ylab(\"Time\") +\r\n      xlab(names(Resource)) +\r\n      labs(color=names(User))+\r\n      theme_bw() + \r\n      scale_colour_brewer(palette = settings_colorPalette)\r\n  }\r\n  \r\n  \r\n  \r\n} else {\r\n  showErrorMessageToUser(\r\n    paste(\r\n      \"Start and/or End date incorrectly formatted, required format: %Y-%m-%dT%H:%M:%OS\\n\r\n      More dateformats will be supported in newer version\"\r\n    )\r\n    )\r\n}\r\n}\r\n"}}}],"objects":{"rcv_script":{"properties":{"provider":{"type":{"text":true}},"source":{"type":{"scripting":{"source":true}}}}},"settings":{"displayName":"Settings","description":"Schedule view settings","properties":{"orientation":{"displayName":"Orientation","description":"Visual orientation","type":{"enumeration":[{"displayName":"Horizontal","value":"horizontal"},{"displayName":"Vertical","value":"vertical"}]}},"colorPalette":{"displayName":"Color palette","description":"Select brewer color palette","type":{"enumeration":[{"displayName":"Spring","value":"Accent"},{"displayName":"Vintage","value":"Dark2"},{"displayName":"Green and blue","value":"Paired"},{"displayName":"Vintage light","value":"Pastel1"},{"displayName":"Modern light","value":"Pastel2"},{"displayName":"Retro light","value":"Set1"},{"displayName":"Retro","value":"Set2"},{"displayName":"Modern","value":"Set3"}]}}}}},"suppressDefaultTitle":true},"dependencies":{"cranPackages":[{"name":"ggplot2","displayName":"GG Plot 2","url":"https://cran.r-project.org/web/packages/ggplot2/index.html"},{"name":"grid","displayName":"Grid","url":"https://cran.r-project.org/web/packages/grid/index.html"},{"name":"gridExtra","displayName":"Grid Extra","url":"https://cran.r-project.org/web/packages/gridExtra/index.html"},{"name":"wesanderson","displayName":"A Wes Anderson Palette Generator","url":"https://cran.r-project.org/web/packages/wesanderson/index.html"}]},"content":{"js":"var powerbi;!function(e){var i;!function(e){var i;!function(e){var i;!function(e){function i(e,i,t,a){if(e){var n=e[i];if(n){var s=n[t];if(void 0!==s)return s}}return a}function t(e,i,t,a){if(e){var n=e[i];if(n){var s=n[t];if(void 0!==s&&void 0!==s.solid&&void 0!==s.solid.color)return s.solid.color}}return a}e.getValue=i,e.getFillValue=t}(i=e.PBI_CV_658497A5_7E34_4F94_A51F_4E2213BB9051||(e.PBI_CV_658497A5_7E34_4F94_A51F_4E2213BB9051={}))}(i=e.visual||(e.visual={}))}(i=e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var i;!function(e){var i;!function(e){var i;!function(e){var i=function(){function i(e){this.imageDiv=document.createElement(\"div\"),this.imageDiv.className=\"rcv_autoScaleImageContainer\",e.element.appendChild(this.imageDiv),this.imageElement=document.createElement(\"img\"),this.imageElement.className=\"rcv_autoScaleImage\",this.imageDiv.appendChild(this.imageElement)}return i.prototype.update=function(e){var i=e.dataViews;if(i&&0!==i.length){var t=i[0];if(t&&t.metadata){this.updateObjects(t.metadata.objects);var a=null;t.scriptResult&&t.scriptResult.payloadBase64&&(a=\"data:image/png;base64,\"+t.scriptResult.payloadBase64),a?this.imageElement.src=a:this.imageElement.src=null,this.onResizing(e.viewport)}}},i.prototype.onResizing=function(e){this.imageDiv.style.height=e.height+\"px\",this.imageDiv.style.width=e.width+\"px\"},i.prototype.updateObjects=function(i){this.settings={orientation:e.getValue(i,\"settings\",\"orientation\",\"horizontal\"),colorPalette:e.getValue(i,\"settings\",\"colorPallette\",\"Set1\")}},i.prototype.enumerateObjectInstances=function(e){var i=e.objectName,t=[];switch(i){case\"settings\":t.push({objectName:i,properties:{orientation:this.settings.orientation,colorPalette:this.settings.colorPalette},selector:null})}return t},i}();e.Visual=i}(i=e.PBI_CV_658497A5_7E34_4F94_A51F_4E2213BB9051||(e.PBI_CV_658497A5_7E34_4F94_A51F_4E2213BB9051={}))}(i=e.visual||(e.visual={}))}(i=e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var i;!function(i){var t;!function(i){i.PBI_CV_658497A5_7E34_4F94_A51F_4E2213BB9051={name:\"PBI_CV_658497A5_7E34_4F94_A51F_4E2213BB9051\",displayName:\"ScheduleView\",class:\"Visual\",version:\"1.0.0\",apiVersion:\"1.3.0\",create:function(i){return new e.extensibility.visual.PBI_CV_658497A5_7E34_4F94_A51F_4E2213BB9051.Visual(i)},custom:!0}}(t=i.plugins||(i.plugins={}))}(i=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));","css":".visual-PBI_CV_658497A5_7E34_4F94_A51F_4E2213BB9051 .rcv_autoScaleImageContainer{position:relative}.visual-PBI_CV_658497A5_7E34_4F94_A51F_4E2213BB9051 .rcv_autoScaleImageContainer .rcv_autoScaleImage{max-width:100%;max-height:100%;position:absolute;top:50%;left:50%;transform:translateY(-50%) translateX(-50%);-webkit-transform:translateY(-50%) translateX(-50%)}","iconBase64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUAgMAAADw5/WeAAAACVBMVEUAAAAAl7FhYWA9yqGWAAAAAXRSTlMAQObYZgAAACJJREFUCNdjgADR0FCvFThJCNBa1Rgagp+EqVwI1IWTBAMA4+kexFglxAgAAAAASUVORK5CYII="}}